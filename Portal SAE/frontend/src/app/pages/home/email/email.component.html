<div class="flex m-3 main-container" style="display: flex; flex-direction: column; height: 100%;">
  <div class="content-container bg-secondary" 
       style="display: flex; justify-content: flex-end; align-items: center; padding: 10px;">
    <button mat-fab extended color="primary" (click)="fetchData()" [disabled]="isLoading || isApiBusy">
      <mat-icon>updateEmails</mat-icon>
      <span>Actualizar Correos</span>
    </button>
    <button class="d-flex ms-2" mat-fab extended color="primary" (click)="openEmailForm()">
      <i class="fa-solid fa-paper-plane me-2" ></i>
      <span>Enviar Correos </span>
    </button>
  </div>

  
  <!-- Spinner -->
<div *ngIf="isLoading" class="spinner-container">
  <mat-progress-spinner color="primary" mode="indeterminate"></mat-progress-spinner>
</div>


  <!-- Tabla de correos  -->

  <div class="table-container" style="flex-grow: 1; margin-top: 15px;">
    <table mat-table [dataSource]="tableDataSource" matSort #sort="matSort">
      <ng-container matColumnDef="contenido">
        <th mat-sort-header mat-header-cell *matHeaderCellDef>Contenido</th>
        <td mat-cell *matCellDef="let element" (click)="element.contenido ? openEmailDetails(element) : null">
          <mat-icon *ngIf="element.contenido">open_in_new</mat-icon>
        </td>
      </ng-container>

      <ng-container matColumnDef="remitente">
        <th mat-sort-header mat-header-cell *matHeaderCellDef>Remitente</th>
        <td mat-cell *matCellDef="let element">
          {{ (element.remitente) }}
        </td>
      </ng-container>

      <ng-container matColumnDef="destinatario">
        <th mat-sort-header mat-header-cell *matHeaderCellDef>Destinatario</th>
        <td mat-cell *matCellDef="let element">
          {{ element.destinatario }}
        </td>
      </ng-container>

      <ng-container matColumnDef="asunto">
        <th mat-sort-header mat-header-cell *matHeaderCellDef>Asunto</th>
        <td mat-cell *matCellDef="let element">
          {{ element.asunto }}
        </td>
      </ng-container>

      <ng-container matColumnDef="fechaRecibido">
        <th mat-sort-header mat-header-cell *matHeaderCellDef>Fecha Recibido</th>
        <td mat-cell *matCellDef="let element">
          {{ element.fechaRecibido | date:'short' }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: columns" (click)="onRowClick(row, $event)"
        [class.selected-row]="selectedRows.isSelected(row)"></tr>
    </table>
  </div>
  
  <!-- Paginador -->
  <mat-paginator #paginator [pageSize]="30" [pageSizeOptions]="[5, 10, 25, 50]"></mat-paginator>
</div>